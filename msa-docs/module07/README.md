# Service Discovery

---

## 1. μλ„ / λ¬Έμ 

### μλ„

μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬λ” λ¶„μ‚° μ‹μ¤ν… ν™κ²½μ—μ„ μ„λΉ„μ¤μ μ„μΉλ¥Ό μλ™μΌλ΅ μ°Ύμ•„μ£Όλ” κΈ°λ¥μ…λ‹λ‹¤. μ΄λ¥Ό μ‚¬μ©ν•λ©΄ μ„λΉ„μ¤ κ°„μ μƒνΈμ‘μ©μ„ μ›ν™ν•κ² ν•μ—¬ κ΄€λ¦¬μ λ³µμ΅μ„±μ„ μ¤„μ΄κ³ , λ™μ μΈ ν™κ²½μ—μ„λ„ μ•μ •μ μΌλ΅ μ‹μ¤ν…μ„ μ΄μν•  μ μκ² λ„μ™€μ¤λ‹λ‹¤.

### λ¬Έμ 

λ§μ΄ν¬λ΅μ„λΉ„μ¤ κΈ°λ° μ• ν”λ¦¬μΌ€μ΄μ… μ—μ„λ” μ—¬λ¬ μ„λΉ„μ¤κ°€ μ„λ΅λ¥Ό νΈμ¶ν•λ©°, κ° μ„λΉ„μ¤μ μΈμ¤ν„΄μ¤ μμ™€ μ„μΉκ°€ λ™μ μΌλ΅ λ³€κ²½λ©λ‹λ‹¤. μ΄λ¬ν• ν™κ²½μ—μ„λ” κΈ°μ΅΄μ κ³ μ •λ μ„λΉ„μ¤ νΈμ¶ λ°©μ‹μ΄ μ μ ν•μ§€ μ•μµλ‹λ‹¤. νΉν κ°€μƒν™”λκ±°λ‚ μ»¨ν…μ΄λ„ν™”λ ν™κ²½μ—μ„λ” μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μμ™€ μ„μΉκ°€ λμ„μ—†μ΄ λ³€ν™”ν•κΈ° λ•λ¬Έμ—, μ΄μ— λ”°λ¥Έ μ•„λμ™€ κ°™μ€ λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

- ν΄λΌμ΄μ–ΈνΈ(API κ²μ΄νΈμ›¨μ΄λ‚ λ‹¤λ¥Έ μ„λΉ„μ¤)κ°€ ν•„μ”ν• μ„λΉ„μ¤μ ν„μ¬ μ„μΉλ¥Ό μ• μ μ—†μµλ‹λ‹¤.
- μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ λ³€κ²½(μ¶”κ°€, μ κ±°, μ„μΉ λ³€κ²½ λ“±)μ„ μ‹¤μ‹κ°„μΌλ΅ μ¶”μ ν•  μ μ—†μµλ‹λ‹¤.

![egov_example](./images/MSA%20λ‚΄μ—μ„%20λ°μƒν•λ”%20λ¬Έμ μ %20κ·Έλ¦Ό.png)

μ΄λ¬ν• λ¬Έμ μ λ“¤μ„ ν•΄κ²°ν•κΈ° μ„ν•΄ κ° μ„λΉ„μ¤μ ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— μ§μ ‘ κµ¬ν„ν•λ” κ²ƒμ€ λΉ„ν¨μ¨μ μ΄λ©°, λ³µμ΅ν• λ΅μ§κ³Ό μ¤‘λ³µ μ½”λ“λ΅ μΈν•΄ μ¤λ¥κ°€ λ°μƒν•κΈ° μ‰½κ³ , μ„λΉ„μ¤ μκ°€ μ¦κ°€ν• μλ΅ κ΄€λ¦¬κ°€ λ”μ± μ–΄λ ¤μ›μ§‘λ‹λ‹¤.

λ”°λΌμ„, ν΄λΌμ΄μ–ΈνΈκ°€ λ™μ μΌλ΅ λ³€ν™”ν•λ” μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ— λ€ν•΄ ν¨μ¨μ μΌλ΅ μ”μ²­ν•  μ μλ„λ΅ μ§€μ›ν•λ” λ§¤μ»¤λ‹μ¦μ΄ ν•„μ”ν•©λ‹λ‹¤. λν•, μ΄ λ©”μ»¤λ‹μ¦μ€ λ³€ν™”ν•λ” μ„λΉ„μ¤ κµ¬μ΅°μ— ν¨μ¨μ μΌλ΅ λ€μ‘ν•λ©΄μ„λ„, ν–¥ν›„ μ„λΉ„μ¤κ°€ μ¶”κ°€λ  λ• μ‰½κ² ν™•μ¥ν•  μ μμ–΄μ•Ό ν•©λ‹λ‹¤.



## 2. ν•΄κ²°λ²•

### 2.1. Service registry

- μ •μ
  - μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ” μ—¬λ¬ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ λ©”νƒ€λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ³  κ΄€λ¦¬ν•λ” μ¤‘μ•™ μ§‘μ¤‘μ‹ μ €μ¥μ†μ…λ‹λ‹¤.
  - κ° μ„λΉ„μ¤ μΈμ¤ν„΄μ¤λ” λ μ§€μ¤νΈλ¦¬μ— μμ‹ μ μ •λ³΄λ¥Ό λ“±λ΅ν•κ³ , ν•„μ”ν•  λ• ν•΄μ ν•  μ μμµλ‹λ‹¤.

- κΈ°λ¥
  - **λ“±λ΅κ³Ό ν•΄μ **: μ„λΉ„μ¤ μΈμ¤ν„΄μ¤λ” μ‹μ‘ν•  λ• μμ‹ μ„ λ μ§€μ¤νΈλ¦¬μ— λ“±λ΅ν•κ³ , μΆ…λ£ν•  λ• ν•΄μ ν•©λ‹λ‹¤. μ΄ κ³Όμ •μ„ ν†µν•΄ μ„λΉ„μ¤μ κ°€μ©μ„±μ„ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.
  - **μƒνƒ λ¨λ‹ν„°λ§**: μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ” μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μƒνƒλ¥Ό μ£ΌκΈ°μ μΌλ΅ ν™•μΈν•μ—¬, λΉ„μ •μƒμ μΈ μΈμ¤ν„΄μ¤λ¥Ό κ°μ§€ν•κ³  μλ™μΌλ΅ λ©λ΅μ—μ„ μ κ±°ν•  μ μμµλ‹λ‹¤.
  - **μ„λΉ„μ¤ μ •λ³΄ μ κ³µ**: ν΄λΌμ΄μ–ΈνΈλ” μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό ν†µν•΄ μ„λΉ„μ¤μ ν„μ¬ μ„μΉ(νΈμ¤νΈ, ν¬νΈ λ“±)μ™€ μƒνƒ(μ •μƒ, λΉ„μ •μƒ λ“±)λ¥Ό μ΅°νν•  μ μμµλ‹λ‹¤.
- μμ‹: Netflix Eureka, Consul, Zookeeper λ“±μ΄ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ μμ…λ‹λ‹¤.


### 2.2. Service Client

- μ •μ
  - μ„λΉ„μ¤ ν΄λΌμ΄μ–ΈνΈλ” νΉμ • μ„λΉ„μ¤μ— μ ‘κ·Όν•κΈ° μ„ν•΄ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό μ΅°νν•κ³  μ”μ²­μ„ λ³΄λ‚΄λ” μ• ν”λ¦¬μΌ€μ΄μ…μ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” ν•„μ”ν• μ„λΉ„μ¤μ μ •λ³΄λ¥Ό λ™μ μΌλ΅ λ°›μ•„μ™€μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

- κΈ°λ¥
  - μ„λΉ„μ¤ μ΅°ν: μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ— μ ‘κ·Όν•μ—¬ ν•„μ”ν• μ„λΉ„μ¤μ μ„μΉλ¥Ό ν™•μΈν•κ³ , κ·Έμ— λ”°λΌ μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.
  - λ΅λ“ λ°Έλ°μ‹±: ν΄λΌμ΄μ–ΈνΈλ” μ—¬λ¬ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤ μ¤‘ ν•λ‚λ¥Ό μ„ νƒν•μ—¬ μ”μ²­μ„ λ³΄λ‚Ό μ μμΌλ©°, μ΄ κ³Όμ •μ—μ„ λ΅λ“ λ°Έλ°μ‹±μ„ μν–‰ν•μ—¬ λ¶€ν•λ¥Ό λ¶„μ‚°μ‹ν‚¬ μ μμµλ‹λ‹¤.
  - μƒνƒ ν™•μΈ: ν΄λΌμ΄μ–ΈνΈλ” μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ—μ„ μ„λΉ„μ¤μ μƒνƒλ¥Ό ν™•μΈν•μ—¬, λΉ„μ •μƒμ μΈ μΈμ¤ν„΄μ¤μ— μ”μ²­μ„ λ³΄λ‚΄μ§€ μ•λ„λ΅ ν•©λ‹λ‹¤.
  > μ„ κΈ°λ¥λ“¤μ€ μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ ν¨ν„΄ μ¤‘ ν΄λΌμ΄μ–ΈνΈ-μ‚¬μ΄λ“ λ””μ¤μ»¤λ²„λ¦¬ ν¨ν„΄μ„ μ μ©ν–μ„ λ• μ£Όλ΅ μ‚¬μ©λ©λ‹λ‹¤.
  > μ„λ²„-μ‚¬μ΄λ“ λ””μ¤μ»¤λ²„λ¦¬ ν¨ν„΄μ„ μ μ©ν• κ²½μ°μ—λ” API Gatewayμ™€ κ°™μ€ μ¤‘μ•™ μ§‘μ¤‘μ‹ μ»΄ν¬λ„νΈκ°€ μ΄ μ—­ν• μ„ λ€μ‹ ν•΄ μ¤λ‹λ‹¤.

- μμ‹: API κ²μ΄νΈμ›¨μ΄, λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ• ν”λ¦¬μΌ€μ΄μ… λ“±μ—μ„ μ„λΉ„μ¤ ν΄λΌμ΄μ–ΈνΈλ¥Ό κµ¬ν„ν•μ—¬ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

### 2.3. Service Discovery

- μ •μ
  - μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό ν†µν•΄ μ„λΉ„μ¤μ μ„μΉλ¥Ό μ°Ύκ³ , μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μƒνƒλ¥Ό μ‹¤μ‹κ°„μΌλ΅ ν™•μΈν•  μ μλ„λ΅ ν•λ” λ©”μ»¤λ‹μ¦μ…λ‹λ‹¤.
- κΈ°λ¥
  - μλ™ κ²€μƒ‰: ν΄λΌμ΄μ–ΈνΈλ” μ§μ ‘ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μ„μΉλ¥Ό μ• ν•„μ” μ—†μ΄, μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό ν†µν•΄ ν•„μ”ν• μ„λΉ„μ¤λ¥Ό μλ™μΌλ΅ κ²€μƒ‰ν•  μ μμµλ‹λ‹¤.
  - μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ: μ„λΉ„μ¤ μΈμ¤ν„΄μ¤κ°€ μ¶”κ°€λκ±°λ‚ μ κ±°λ  λ•, μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ” μ΄λ¥Ό μλ™μΌλ΅ λ°μν•μ—¬ ν΄λΌμ΄μ–ΈνΈκ°€ μµμ‹  μ •λ³΄λ¥Ό κΈ°λ°μΌλ΅ μ”μ²­μ„ λ³΄λ‚Ό μ μκ² ν•©λ‹λ‹¤.
  - μƒνΈμ‘μ©μ κ°„μ†ν™”: μ„λΉ„μ¤ κ°„μ νΈμ¶ κ΄€κ³„λ¥Ό λ…μ‹μ μΌλ΅ κ΄€λ¦¬ν•μ§€ μ•μ•„λ„ λλ―€λ΅, λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ•„ν‚¤ν…μ²μ—μ„μ μ„λΉ„μ¤ κ°„ μƒνΈμ‘μ©μ΄ κ°„νΈν•΄μ§‘λ‹λ‹¤.
- μμ‹
  - Spring Cloud Netflix Eurekaμ μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ κΈ°λ¥μ΄ λ€ν‘μ μΈ μμ…λ‹λ‹¤.
  - ν΄λΌμ΄μ–ΈνΈκ°€ Eureka μ„λ²„λ¥Ό ν†µν•΄ λ‹¤λ¥Έ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤λ¥Ό μ‰½κ² μ°Ύμ„ μ μλ„λ΅ λ„μ™€μ¤λ‹λ‹¤.

μ¤‘μ”ν• μ μ€ λ¨λ“  μ„λΉ„μ¤μ μ„μΉλ¥Ό ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ κ΄€λ¦¬ν•  ν•„μ”κ°€ μ—†λ‹¤λ” κ²ƒμ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό ν†µν•΄ ν•„μ”ν• μ„λΉ„μ¤λ§ μ΅°νν•κ³ , μ΄λ¥Ό ν†µν•΄ μ›ν•λ” κΈ°λ¥μ„ μν–‰ν•λ” μ„λΉ„μ¤μ— μ ‘κ·Όν•  μ μμµλ‹λ‹¤. μ„λΉ„μ¤ μΈμ¤ν„΄μ¤κ°€ λ³€κ²½λ  λ•λ§λ‹¤ ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ¥Ό μΈμ§€ν•κ³  μ—…λ°μ΄νΈν•  ν•„μ”λ” μ—†μΌλ©°, μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬κ°€ μ΄λ¥Ό μλ™μΌλ΅ κ΄€λ¦¬ν•©λ‹λ‹¤.

### 2.4. Service Discovery Pattern

#### π“ `Client-side Service Discovery`

- μ„λΉ„μ¤μ— μ”μ²­μ„ ν•  λ•, ν΄λΌμ΄μ–ΈνΈλ” λ¨λ“  μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μ„μΉλ¥Ό μ•κ³  μλ” μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό μ΅°νν•μ—¬ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μ„μΉλ¥Ό ν™•λ³΄ν•©λ‹λ‹¤.
- μ•„λ κ·Έλ¦Όμ€ μ΄ ν¨ν„΄μ κµ¬μ΅°λ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤.

![egov_example](./images/ν΄λΌμ΄μ–ΈνΈ%20μ‚¬μ΄λ“.png)

#### π“ `Server-side Service Discovery`

- μ„λΉ„μ¤μ— μ”μ²­ν•  λ•, ν΄λΌμ΄μ–ΈνΈλ” μ •ν•΄μ§„ μ„μΉμ—μ„ μ‹¤ν–‰λλ” λΌμ°ν„°(λλ” λ΅λ“ λ°Έλ°μ„)λ¥Ό ν†µν•΄ μ”μ²­μ„ ν•©λ‹λ‹¤.
- λΌμ°ν„°λ” μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό μ΅°νν•μ—¬ μ‚¬μ© κ°€λ¥ν• μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ— μ”μ²­μ„ μ „λ‹¬ν•©λ‹λ‹¤.
(μ΄ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ” λΌμ°ν„°μ— λ‚΄μ¥λμ–΄ μμ„ μλ„ μμµλ‹λ‹¤.)
- μ•„λ κ·Έλ¦Όμ€ μ΄ ν¨ν„΄μ κµ¬μ΅°λ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤.

![egov_example](./images/μ„λ²„%20μ‚¬μ΄λ“.png)


---

## 3. μ¥λ‹¨μ 

### 3.1. Client-side vs Server-side Service Discovery

#### π“ `Client-side Service Discovery`
**Client-side μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬**μ—μ„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ—μ„ μ§μ ‘ μ„λΉ„μ¤ μ„μΉλ¥Ό μ΅°νν•κ³ , ν•΄λ‹Ή μ„λΉ„μ¤λ΅ μ§μ ‘ μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.

- **μ¥μ **:
  - λ‹¨μμ„±: ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ„λΉ„μ¤λ¥Ό νΈμ¶ν•©λ‹λ‹¤.
  - μ μ—°μ„±: ν΄λΌμ΄μ–ΈνΈκ°€ λ΅λ“ λ°Έλ°μ‹± λ΅μ§μ„ μ§μ ‘ κµ¬ν„ν•  μ μμµλ‹λ‹¤.
  - μ§€μ—°μ‹κ°„ κ°μ†: ν΄λΌμ΄μ–ΈνΈμ™€ μ„λΉ„μ¤ κ°„μ— μ¤‘κ°„ λ‹¨κ³„κ°€ μ—†μµλ‹λ‹¤.

- **λ‹¨μ **:
  - ν΄λΌμ΄μ–ΈνΈ λ³µμ΅μ„± μ¦κ°€: κ° ν΄λΌμ΄μ–ΈνΈκ°€ μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ λ΅μ§μ„ κµ¬ν„ν•΄μ•Ό ν•©λ‹λ‹¤.
  - κ°•ν• κ²°ν•©: ν΄λΌμ΄μ–ΈνΈκ°€ λ””μ¤μ»¤λ²„λ¦¬ κ³Όμ •κ³Ό κ°•ν•κ² κ²°ν•©λ©λ‹λ‹¤.
  - ν™•μ¥μ„± μ ν•: μ„λΉ„μ¤κ°€ λ§μ•„μ§€λ©΄ κ° ν΄λΌμ΄μ–ΈνΈμ λ””μ¤μ»¤λ²„λ¦¬ λ΅μ§ κ΄€λ¦¬κ°€ μ–΄λ ¤μ›μ§ μ μμµλ‹λ‹¤.

  <br>

#### π“ `Server-side Service Discovery`
**Server-side μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬**μ—μ„λ” ν΄λΌμ΄μ–ΈνΈκ°€ λ΅λ“ λ°Έλ°μ„λ‚ ν”„λ΅μ‹ μ„λ²„μ— μ”μ²­μ„ λ³΄λ‚΄λ©΄, μ΄ μ„λ²„κ°€ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ— μ§μν•κ³  μ μ ν• μ„λΉ„μ¤λ΅ μ”μ²­μ„ μ „λ‹¬ν•©λ‹λ‹¤.

- **μ¥μ **:
  - ν΄λΌμ΄μ–ΈνΈ λ‹¨μν™”: ν΄λΌμ΄μ–ΈνΈκ°€ λ””μ¤μ»¤λ²„λ¦¬ λ΅μ§μ„ μ²λ¦¬ν•μ§€ μ•μ•„λ„ λ©λ‹λ‹¤.
  - μ¤‘μ•™ μ§‘μ¤‘ μ μ–΄: λ΅λ“ λ°Έλ°μ‹± λ° λΌμ°ν… κ²°μ •μ΄ μ¤‘μ•™μ—μ„ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.
  - ν™•μ¥μ„± μ©μ΄: ν΄λΌμ΄μ–ΈνΈ μ „λ°μ— κ±Έμ³ λ””μ¤μ»¤λ²„λ¦¬ λ΅μ§μ„ κ΄€λ¦¬ν•λ” λ³µμ΅μ„±μ„ μ¤„μ—¬μ¤λ‹λ‹¤.

- **λ‹¨μ **:
  - μ¶”κ°€μ μΈ μ¤‘κ°„ λ‹¨κ³„: μ”μ²­μ΄ μ¤‘κ°„ μ„λ²„λ¥Ό κ±°μΉλ©΄μ„ μ§€μ—° μ‹κ°„μ΄ μ¦κ°€ν•  μ μμµλ‹λ‹¤.
  - λ‹¨μΌ μ‹¤ν¨ μ§€μ : λ΅λ“ λ°Έλ°μ„λ‚ ν”„λ΅μ‹ μ„λ²„κ°€ μ‹¤ν¨ν•λ©΄ μ„λΉ„μ¤ μ”μ²­μ΄ μ „λ‹¬λμ§€ μ•μ„ μ μμµλ‹λ‹¤.
  - μΈν”„λΌ κµ¬μ„±: λ΅λ“ λ°Έλ°μ„ κ°™μ€ μ¶”κ°€μ μΈ μΈν”„λΌ κµ¬μ„±μ΄ ν•„μ”ν•©λ‹λ‹¤. λ΅λ“ λ°Έλ°μ„ μ„¤μ • λ° κ΄€λ¦¬μ— μ¶”κ°€μ μΈ μ‘μ—…μ΄ ν•„μ”ν•©λ‹λ‹¤.


<br>

#### π“ `λΉ„κµ μ •λ¦¬`

| **νΉμ§•** | **Client-side Discovery** | **Server-side Discovery** |
| --- | --- | --- |
| **λ΅λ“ λ°Έλ°μ‹± μ„μΉ** | ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μν–‰ | μ„λ²„ μΈ΅ λ΅λ“ λ°Έλ°μ„κ°€ μν–‰ |
| **ν΄λΌμ΄μ–ΈνΈ λ³µμ΅μ„±** | ν΄λΌμ΄μ–ΈνΈκ°€ μ„λΉ„μ¤ μ„μΉ λ° λ΅λ“ λ°Έλ°μ‹± μ•κ³ λ¦¬μ¦μ„ κ΄€λ¦¬ | ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν™”, λ΅λ“ λ°Έλ°μ„λ” μ„λ²„κ°€ μ²λ¦¬ |
| **μ„λΉ„μ¤ μ„μΉ μ •λ³΄ κ΄€λ¦¬** | ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ—μ„ μ΅°ν | μ„λ²„ μΈ΅ λ΅λ“ λ°Έλ°μ„κ°€ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ—μ„ μ΅°ν |
| **μ¶”κ°€ μΈν”„λΌ μ”κµ¬ μ‚¬ν•­** | μ¶”κ°€ μΈν”„λΌ ν•„μ” μ—†μ | μ„λ²„ μΈ΅ λ΅λ“ λ°Έλ°μ„ λλ” ν”„λ΅μ‹ μ„λ²„ ν•„μ” |
| **μ μ—°μ„±** | ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¤μ–‘ν• λ΅λ“ λ°Έλ°μ‹± μ „λµμ„ μ μ© κ°€λ¥ | μ„λ²„ μΈ΅μ—μ„ λ‹¤μ–‘ν• νΈλν”½ κ΄€λ¦¬ κΈ°λ¥μ„ μ κ³µ |

<br>

---

### 3.2. 3rd Party vs Self-hosted Service Registry

#### π“ `3rd Party Service Registry`
**3rd party μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬**λ” μ™Έλ¶€μ—μ„ μ κ³µλλ” κ΄€λ¦¬ν• μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤. 3rd partyλ€ μ΄λ¦„ κ·Έλ€λ΅ λ‹¤λ¥Έ νμ‚¬λ‚ μ„λΉ„μ¤ μ κ³µμκ°€ μ κ³µν•λ” μ„λΉ„μ¤λ¥Ό μλ―Έν•©λ‹λ‹¤. μ‚¬μ©μλ” λ μ§€μ¤νΈλ¦¬λ¥Ό μ§μ ‘ μ΄μν•μ§€ μ•κ³ , μ΄λ“¤μ΄ μ κ³µν•λ” APIλ¥Ό ν†µν•΄ μ„λΉ„μ¤ μ •λ³΄λ¥Ό λ“±λ΅ν•κ³  μ΅°νν•  μ μμµλ‹λ‹¤. μ΄ λ°©μ‹μ μ¥μ μ€ μΈν”„λΌ κ΄€λ¦¬μ— λ€ν• λ¶€λ‹΄μ„ μ¤„μ΄κ³ , λΉ λ¥΄κ² λ””μ¤μ»¤λ²„λ¦¬ κΈ°λ¥μ„ κµ¬ν„ν•  μ μλ‹¤λ” μ μ…λ‹λ‹¤.

- **μ¥μ **:
  - μ μ§€λ³΄μ λ¶€λ‹΄ κ°μ†: μ„λΉ„μ¤ μ κ³µμκ°€ μΈν”„λΌμ™€ ν™•μ¥μ„±μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.
  - λΉ λ¥Έ μ„¤μ •: μΈν”„λΌλ¥Ό μ‹ κ²½ μ“Έ ν•„μ” μ—†μ΄ λΉ λ¥΄κ² κµ¬ν„ κ°€λ¥ν•©λ‹λ‹¤.
  - λ†’μ€ κ°€μ©μ„±: λ³΄ν†µ λ‚΄μ¥λ μ¤‘λ³µμ„±κ³Ό λ†’μ€ κ°€μ©μ„±μ„ μ κ³µν•©λ‹λ‹¤.

- **λ‹¨μ **:
  - λ²¤λ” μΆ…μ†μ„±: νΉμ • μ„λΉ„μ¤ μ κ³µμμ— μμ΅΄ν•κ² λ©λ‹λ‹¤.
  - μ»¤μ¤ν„°λ§μ΄μ§• μ ν•: μ κ³µμκ°€ μ •ν• κΈ°λ¥κ³Ό μ„¤μ • λ‚΄μ—μ„λ§ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.
  - μ μ¬μ  μ§€μ—°μ‹κ°„: μΈν„°λ„·μ„ ν†µν•΄ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬μ— μ ‘κ·Όν•  κ²½μ° μ§€μ—°μ΄ λ°μƒν•  μ μμµλ‹λ‹¤.

- **μμ‹**:
  - Consul Cloud (HashiCorp)
  - AWS Cloud Map
  - Azure Service Fabric
  - Google Cloud Service Directory

  <br>

#### π“ `Self-hosted Service Registry`
**Self-hosted μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬**λ” μ΅°μ§μ΄ μ§μ ‘ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό μ„¤μΉν•κ³  μ΄μν•λ” λ°©μ‹μ…λ‹λ‹¤. ν•„μ”ν• μ†ν”„νΈμ›¨μ–΄λ¥Ό μ§μ ‘ κ΄€λ¦¬ν•κ³ , ν΄λ¬μ¤ν„° λ‚΄μ—μ„ λ™μ‘ν•λ” λ¨λ“  μ„λΉ„μ¤μ μ •λ³΄λ¥Ό μ§μ ‘ λ“±λ΅ν•κ³  κ΄€λ¦¬ν•κ² λ©λ‹λ‹¤. μ΄λ” νΉμ • ν΄λΌμ°λ“ μ κ³µμμ— μΆ…μ†λμ§€ μ•μΌλ©°, μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬λ¥Ό λ³΄λ‹¤ μ„Έλ°€ν•κ² μ μ–΄ν•  μ μλ‹¤λ” μ¥μ μ΄ μμµλ‹λ‹¤. κ·Έλ¬λ‚ μ§μ ‘ μ„¤μΉν•κ³  κ΄€λ¦¬ν•λ” λ¶€λ‹΄μ΄ λ”°λ¦…λ‹λ‹¤.

- **μ¥μ **:
  - μ™„μ „ν• μ μ–΄: λ μ§€μ¤νΈλ¦¬μ κµ¬μ„±κ³Ό μ΄μμ„ μ™„λ²½ν•κ² μ μ–΄ν•  μ μμµλ‹λ‹¤.
  - μ»¤μ¤ν„°λ§μ΄μ§• κ°€λ¥: μ΅°μ§μ ν•„μ”μ— λ§κ² μμ λ΅­κ² μ„¤μ •ν•  μ μμµλ‹λ‹¤.
  - λ²¤λ” μΆ…μ†μ„± μ—†μ: μ™Έλ¶€ μ κ³µμμ— μμ΅΄ν•μ§€ μ•μµλ‹λ‹¤.

- **λ‹¨μ **:
  - μ μ§€λ³΄μ λ¶€λ‹΄: λ μ§€μ¤νΈλ¦¬μ μ μ§€λ³΄μ, ν™•μ¥ λ° μ—…λ°μ΄νΈλ¥Ό μ§μ ‘ λ‹΄λ‹Ήν•΄μ•Ό ν•©λ‹λ‹¤.
  - μΈν”„λΌ λΉ„μ©: νΈμ¤ν… λ° μ μ§€ κ΄€λ¦¬λ¥Ό μ„ν• ν•λ“μ›¨μ–΄λ‚ ν΄λΌμ°λ“ μμ›μ΄ ν•„μ”ν•©λ‹λ‹¤.
  - λ³µμ΅μ„± μ¦κ°€: μμ²΄ μ΄μ λ μ§€μ¤νΈλ¦¬λ¥Ό κ΄€λ¦¬ν•κ³  ν™•μ¥ν•λ” λ° λ³µμ΅μ„±μ΄ μ¶”κ°€λ©λ‹λ‹¤.

- **μμ‹**:
  - Consul (HashiCorp)
  - etcd (CoreOS)
  - Zookeeper (Apache)
  - Eureka (Netflix)

<br>

#### π“ `μ •λ¦¬`

| **λ μ§€μ¤νΈλ¦¬** | **μ£Όμ” μ‚¬μ© μ‚¬λ΅€** | **νΉμ§•** | **μ¥μ ** | **λ‹¨μ ** |
| --- | --- | --- | --- | --- |
| **Eureka** | Spring Cloud, ν΄λΌμ΄μ–ΈνΈ λ΅λ“ λ°Έλ°μ‹± | Client-Side Discovery, Spring Cloudμ™€ ν†µν•© | Spring Cloudμ™€μ κ°•λ ¥ν• ν†µν•© | λ³µμ΅ν• μ„¤μ • λ° ν™•μ¥μ„± μ΄μ |
| **Consul** | ν—¬μ¤ μ²΄ν¬, μ„¤μ • κ΄€λ¦¬, λ‹¤μ¤‘ λ°μ΄ν„°μ„Όν„° | Client-Side Discovery, Key-Value μ €μ¥μ† μ§€μ› | ν—¬μ¤ μ²΄ν¬ λ° μ„¤μ • κ΄€λ¦¬ κΈ°λ¥, λ‹¤μ¤‘ λ°μ΄ν„°μ„Όν„° μ§€μ› | μ„¤μ • λ³µμ΅μ„±, μ—μ΄μ „νΈ λ°°ν¬ ν•„μ” |
| **Zookeeper** | λ¶„μ‚° μ‹μ¤ν… λ™κΈ°ν™” λ° κµ¬μ„± κ΄€λ¦¬ | μΌκ΄€μ„± μ¤‘μ‹¬, λ¶„μ‚° λ½, λ¦¬λ” μ„ μ¶ λ“± μ§€μ› | κ°•λ ¥ν• μΌκ΄€μ„± λ³΄μ¥, λ‹¤μ–‘ν• λ¶„μ‚° μ‹μ¤ν… κΈ°λ¥ μ κ³µ | λ³µμ΅ν• μ„¤μ • λ° μ΄μ, μ„±λ¥ μ΄μ |
| **Etcd** | Kubernetes μ„¤μ • κ΄€λ¦¬, Key-Value μ €μ¥μ† | Raft μ•κ³ λ¦¬μ¦ κΈ°λ° μΌκ΄€μ„± λ³΄μ¥, λ¶„μ‚° ν™κ²½μ—μ„ λ‚΄κµ¬μ„± μ κ³µ | Kubernetesμ™€μ κ°•λ ¥ν• ν†µν•© | μ ν•λ κΈ°λ¥, μ„±λ¥ λ° ν™•μ¥μ„± μ΄μ |
| **AWS Cloud Map** | AWS κΈ°λ° μ„λΉ„μ¤ λ””μ¤μ»¤λ²„λ¦¬ | AWS μ„λΉ„μ¤μ™€ κΉμ€ ν†µν•©, DNS κΈ°λ° κ²€μƒ‰ | AWS μƒνƒκ³„μ™€ μ™„λ²½ν• ν†µν•© | AWS μΆ…μ†μ„±, λ©€ν‹° ν΄λΌμ°λ“ μ§€μ› λ¶€μ΅± |


<br>

---
---


## 4. κµ¬ν„ μμ‹

### 4.1. egovframe-msa-edu

- λ””λ ‰ν† λ¦¬ κµ¬μ΅°

![egov_example](./images/egov_service_discovery.png)

- μ•„ν‚¤ν…μ²

![egov_example](./images/egov%20μ•„ν‚¤ν…μ².png)

μ΄ κ·Έλ¦Όμ€ egov ν”„λ΅μ νΈ λ‚΄ service-discovery κ΄€λ ¨ μ•„ν‚¤ν…μ²λ¥Ό κ°„λµν•κ² λ‚νƒ€λ‚Έ κ·Έλ¦Όμ…λ‹λ‹¤. κ° ν΄λΌμ΄μ–ΈνΈ μ„λΉ„μ¤λ“¤μ΄ μ§μ ‘ λ μ§€μ¤νΈλ¦¬λ¥Ό μ΅°νν•μ—¬ μ„λΉ„μ¤ μΈμ¤ν„΄μ¤λ¥Ό μ°Ύλ” ν•νƒκ°€ μ•„λ‹ API Gatewayλ¥Ό ν†µν•κ³  μμµλ‹λ‹¤. μ¦‰ ν΄λΌμ΄μ–ΈνΈλ” API Gatewayλ¥Ό ν†µν•΄ μ”μ²­μ„ ν•κ³  API Gatewayμ—μ„λ” Eureka Serverμ Service Registryλ¥Ό μ΅°νν•μ—¬ ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­ν• μ„λΉ„μ¤ μΈμ¤ν„΄μ¤μ μ •λ³΄λ¥Ό μ°Ύμµλ‹λ‹¤.


#### Java νμΌ (`DiscoveryApplication.java`)


```java
package org.egovframe.cloud.discovery;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@EnableEurekaServer
@SpringBootApplication
public class DiscoveryApplication {

    public static void main(String[] args) {
        SpringApplication.run(DiscoveryApplication.class, args);
    }
}
```

μ΄ νμΌμ€ Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μ μ§„μ…μ μ΄λ©°, Eureka μ„λ²„λ¥Ό ν™μ„±ν™”ν•λ” μ• ν”λ¦¬μΌ€μ΄μ…μ…λ‹λ‹¤.

- **`@EnableEurekaServer`**: μ΄ μ• λ…Έν…μ΄μ…μ€ μ΄ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ **Eureka μ„λ²„**λ΅ λ™μ‘ν•κ² ν•©λ‹λ‹¤. Eureka μ„λ²„λ” λ§μ΄ν¬λ΅μ„λΉ„μ¤ ν™κ²½μ—μ„ μ„λΉ„μ¤ λ μ§€μ¤νΈλ¦¬ μ—­ν• μ„ ν•©λ‹λ‹¤. μ—¬λ¬ μ„λΉ„μ¤λ“¤μ΄ Eureka μ„λ²„μ— μμ‹ μ μƒνƒλ¥Ό λ“±λ΅ν•κ³ , μ΄λ¥Ό ν†µν•΄ μ„λΉ„μ¤ κ°„μ ν†µμ‹  λ° λ΅λ“ λ°Έλ°μ‹±μ„ ν•  μ μμµλ‹λ‹¤.

<br>

#### YAML νμΌ (`application.yml`)


```yaml
server:
  port: 8761

spring:
  application:
    name: discovery
  security:
    user:
      name: admin
      password: admin

# eurekaκ°€ ν¬ν•¨λλ©΄ eureka serverλ„ λ“±λ΅λλ―€λ΅ ν•΄μ ν•λ‹¤.
eureka:
  client:
    register-with-eureka: false
    fetch-registry: false
    service-url:
      defaultZone: http://${spring.security.user.name}:${spring.security.user.password}@${eureka.instance.hostname:localhost}:8761/eureka
  server:
    peer-node-read-timeout-ms: 10000
```

μ΄ νμΌμ€ Eureka μ„λ²„μ™€ Spring Boot μ• ν”λ¦¬μΌ€μ΄μ…μ— λ€ν• μ„¤μ •μ„ μ •μν•©λ‹λ‹¤.

1. **spring.application.name: discovery**
    - μ• ν”λ¦¬μΌ€μ΄μ… μ΄λ¦„μ„ discoveryλ΅ μ„¤μ •ν•©λ‹λ‹¤. μ΄ μ΄λ¦„μ€ λ‹¤λ¥Έ λ§μ΄ν¬λ΅μ„λΉ„μ¤λ“¤μ΄ μ΄ μ„λΉ„μ¤λ¥Ό μΈμ‹ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.
2. **spring.security.user.name λ° spring.security.user.password**
    - κΈ°λ³Έ μΈμ¦ μ •λ³΄λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. admin/adminμ΄ μ‚¬μ©μ μ΄λ¦„κ³Ό λΉ„λ°€λ²νΈλ΅ μ„¤μ •λμ–΄ μμµλ‹λ‹¤. μ΄ μ •λ³΄λ” Eureka λ€μ‹λ³΄λ“μ— μ ‘κ·Όν•  λ• μ‚¬μ©λ©λ‹λ‹¤.
3. **eureka.client.register-with-eureka: false λ° eureka.client.fetch-registry: false**
    - Eureka μ„λ²„ μμ²΄κ°€ λ‹¤λ¥Έ Eureka μ„λ²„μ— **μμ‹ μ„ λ“±λ΅ν•μ§€ μ•λ„λ΅** μ„¤μ •ν•©λ‹λ‹¤. μ΄ κ²½μ° Eureka μ„λ²„κ°€ μ¤μ¤λ΅λ¥Ό λ μ§€μ¤νΈλ¦¬μ— λ“±λ΅ν•μ§€ μ•μΌλ©°, λ‹¤λ¥Έ μ„λ²„λ΅λ¶€ν„° λ μ§€μ¤νΈλ¦¬λ¥Ό κ°€μ Έμ¤μ§€ μ•μµλ‹λ‹¤.
4. **eureka.client.service-url.defaultZone**
    - Eureka ν΄λΌμ΄μ–ΈνΈκ°€ Eureka μ„λ²„μ™€ ν†µμ‹ ν•  λ• μ‚¬μ©ν•  κΈ°λ³Έ URLμ„ μ •μν•©λ‹λ‹¤.
    `${spring.security.user.name}:${spring.security.user.password}`λ” μΈμ¦μ„ μ„ν• μ‚¬μ©μ μ΄λ¦„κ³Ό λΉ„λ°€λ²νΈμ…λ‹λ‹¤.
    `${eureka.instance.hostname:localhost}`λ” νΈμ¤νΈ μ΄λ¦„μ„ μ •μν•λ©°, κΈ°λ³Έκ°’μ€ localhostμ…λ‹λ‹¤.
    μ „μ²΄μ μΌλ΅ http://admin:admin@localhost:8761/eureka ν•νƒμ URLμ΄ λ©λ‹λ‹¤.
5. **eureka.server.peer-node-read-timeout-ms**
    - Eureka μ„λ²„ κ°„ ν†µμ‹  μ‹ λ‹¤λ¥Έ λ…Έλ“λ΅λ¶€ν„° μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬λ” μ‹κ°„μ„ 10μ΄λ΅ μ„¤μ •ν•©λ‹λ‹¤.μ΄ μ„¤μ •μ€ λ‹¤μ¤‘ Eureka μ„λ²„ ν΄λ¬μ¤ν„° κµ¬μ„±μ—μ„ μ μ©ν•©λ‹λ‹¤.

<br>

### 4.2. Spring io - service registration and discovery

- repository: https://github.com/spring-guides/gs-service-registration-and-discovery
- κ°€μ΄λ“ λ¬Έμ„: https://spring.io/guides/gs/service-registration-and-discovery

#### eureka-server νμΌ

`EurekaServerApplication.java`
```java
package com.example.eurekaserver;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@SpringBootApplication
@EnableEurekaServer
public class EurekaServerApplication {

	public static void main(String[] args) {
		SpringApplication.run(EurekaServerApplication.class, args);
	}

}
```
`application.yml`
```yaml
spring:
  application:
    name: eureka-server
server:
  port: 8761
eureka:
  client:
    register-with-eureka: false
    fetch-registry: false
logging:
  level:
    com.netflix.eureka: OFF
    com.netflix.discovery: OFF
```

<br>

#### service νμΌ

`ServiceaApplication.java`
```java
package com.example.servicea;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ServiceaApplication {

	public static void main(String[] args) {
		SpringApplication.run(ServiceaApplication.class, args);
	}

}
```
`application.yml`

```yaml
spring:
  application:
    name: servicea
server:
  port: 8081
```

<br>


## 5. μ°Έκ³  μλ£
- https://microservices.io/tags/service%20discovery
- https://spring.io/guides/gs/service-registration-and-discovery
- https://enjoy-dev.tistory.com/2
- https://ksh-coding.tistory.com/137
